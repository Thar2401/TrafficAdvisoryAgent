# UI Components for Streamlit interface\n\nimport streamlit as st\nimport plotly.express as px\nimport plotly.graph_objects as go\nimport pandas as pd\nfrom typing import Dict, List\n\ndef display_metric_card(title: str, value: str, delta: str = None, \n                       help_text: str = None, color: str = \"blue\"):\n    \"\"\"\n    Display a styled metric card\n    \n    Args:\n        title: Metric title\n        value: Main value to display\n        delta: Change indicator (optional)\n        help_text: Help tooltip text\n        color: Color theme\n    \"\"\"\n    colors = {\n        \"blue\": \"#1f77b4\",\n        \"green\": \"#28a745\",\n        \"orange\": \"#fd7e14\",\n        \"red\": \"#dc3545\"\n    }\n    \n    color_code = colors.get(color, colors[\"blue\"])\n    \n    st.markdown(\n        f\"\"\"\n        <div style=\"\n            background: linear-gradient(135deg, {color_code}20 0%, {color_code}10 100%);\n            padding: 1rem;\n            border-radius: 10px;\n            border-left: 4px solid {color_code};\n            margin: 0.5rem 0;\n        \">\n            <h4 style=\"margin: 0; color: {color_code};\">{title}</h4>\n            <h2 style=\"margin: 0.2rem 0; color: #333;\">{value}</h2>\n            {f'<p style=\"margin: 0; color: #666; font-size: 0.9rem;\">{delta}</p>' if delta else ''}\n        </div>\n        \"\"\",\n        unsafe_allow_html=True\n    )\n\ndef create_traffic_heatmap(hourly_data: Dict) -> go.Figure:\n    \"\"\"\n    Create a traffic congestion heatmap\n    \n    Args:\n        hourly_data: Hourly traffic data\n        \n    Returns:\n        go.Figure: Plotly heatmap figure\n    \"\"\"\n    hours = list(range(24))\n    days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']\n    \n    # Create sample heatmap data (in real app, this would come from actual data)\n    z_data = []\n    for day in range(7):\n        day_data = []\n        for hour in range(24):\n            # Use provided data or generate pattern\n            if str(hour) in hourly_data:\n                congestion = hourly_data[str(hour)].get('mean', 0.5)\n            else:\n                # Generate realistic pattern\n                if day < 5:  # Weekdays\n                    if 7 <= hour <= 9 or 17 <= hour <= 19:\n                        congestion = 0.8  # Rush hours\n                    elif 10 <= hour <= 16:\n                        congestion = 0.5  # Daytime\n                    else:\n                        congestion = 0.2  # Off hours\n                else:  # Weekends\n                    if 10 <= hour <= 20:\n                        congestion = 0.4\n                    else:\n                        congestion = 0.1\n            day_data.append(congestion)\n        z_data.append(day_data)\n    \n    fig = go.Figure(data=go.Heatmap(\n        z=z_data,\n        x=hours,\n        y=days,\n        colorscale='RdYlGn_r',\n        showscale=True,\n        colorbar=dict(title=\"Congestion Level\")\n    ))\n    \n    fig.update_layout(\n        title='üóìÔ∏è Weekly Traffic Congestion Heatmap',\n        xaxis_title='Hour of Day',\n        yaxis_title='Day of Week',\n        height=400\n    )\n    \n    return fig\n\ndef create_route_comparison_chart(routes: List[Dict]) -> go.Figure:\n    \"\"\"\n    Create a comparison chart for multiple routes\n    \n    Args:\n        routes: List of route data\n        \n    Returns:\n        go.Figure: Plotly comparison chart\n    \"\"\"\n    if not routes:\n        return go.Figure()\n    \n    route_names = [r.get('description', f'Route {i+1}')[:20] for i, r in enumerate(routes)]\n    travel_times = [r.get('travel_time_min', 0) for r in routes]\n    congestion_scores = [r.get('congestion_score', 0) * 100 for r in routes]  # Convert to percentage\n    distances = [r.get('distance_km', 0) for r in routes]\n    \n    fig = go.Figure()\n    \n    # Travel time bars\n    fig.add_trace(go.Bar(\n        name='Travel Time (min)',\n        x=route_names,\n        y=travel_times,\n        yaxis='y',\n        marker_color='lightblue',\n        text=travel_times,\n        textposition='auto'\n    ))\n    \n    # Congestion score line\n    fig.add_trace(go.Scatter(\n        name='Congestion (%)',\n        x=route_names,\n        y=congestion_scores,\n        yaxis='y2',\n        mode='lines+markers',\n        line=dict(color='red', width=3),\n        marker=dict(size=8)\n    ))\n    \n    fig.update_layout(\n        title='üõ£Ô∏è Route Comparison: Travel Time vs Congestion',\n        xaxis=dict(title='Routes'),\n        yaxis=dict(\n            title='Travel Time (minutes)',\n            side='left'\n        ),\n        yaxis2=dict(\n            title='Congestion Level (%)',\n            side='right',\n            overlaying='y'\n        ),\n        hovermode='x unified',\n        height=500\n    )\n    \n    return fig\n\ndef create_sustainability_gauge(co2_emission: float, max_co2: float = 10.0) -> go.Figure:\n    \"\"\"\n    Create a sustainability gauge chart\n    \n    Args:\n        co2_emission: Current CO2 emission in kg\n        max_co2: Maximum CO2 for scale\n        \n    Returns:\n        go.Figure: Plotly gauge chart\n    \"\"\"\n    # Calculate sustainability score (0-100, higher is better)\n    sustainability_score = max(0, 100 - (co2_emission / max_co2 * 100))\n    \n    fig = go.Figure(go.Indicator(\n        mode = \"gauge+number+delta\",\n        value = sustainability_score,\n        domain = {'x': [0, 1], 'y': [0, 1]},\n        title = {'text': \"üå± Sustainability Score\"},\n        delta = {'reference': 70},\n        gauge = {\n            'axis': {'range': [None, 100]},\n            'bar': {'color': \"darkgreen\"},\n            'steps': [\n                {'range': [0, 50], 'color': \"lightcoral\"},\n                {'range': [50, 80], 'color': \"lightyellow\"},\n                {'range': [80, 100], 'color': \"lightgreen\"}\n            ],\n            'threshold': {\n                'line': {'color': \"red\", 'width': 4},\n                'thickness': 0.75,\n                'value': 90\n            }\n        }\n    ))\n    \n    fig.update_layout(height=300)\n    \n    return fig\n\ndef display_recommendation_card(recommendation: Dict, card_type: str = \"primary\"):\n    \"\"\"\n    Display a styled recommendation card\n    \n    Args:\n        recommendation: Recommendation data\n        card_type: Type of card (primary, alternative, warning)\n    \"\"\"\n    card_styles = {\n        \"primary\": {\n            \"background\": \"linear-gradient(135deg, #28a745 0%, #20c997 100%)\",\n            \"icon\": \"üåü\",\n            \"title_color\": \"white\"\n        },\n        \"alternative\": {\n            \"background\": \"linear-gradient(135deg, #17a2b8 0%, #20c997 100%)\",\n            \"icon\": \"üîÑ\",\n            \"title_color\": \"white\"\n        },\n        \"warning\": {\n            \"background\": \"linear-gradient(135deg, #ffc107 0%, #fd7e14 100%)\",\n            \"icon\": \"‚ö†Ô∏è\",\n            \"title_color\": \"white\"\n        }\n    }\n    \n    style = card_styles.get(card_type, card_styles[\"primary\"])\n    \n    st.markdown(\n        f\"\"\"\n        <div style=\"\n            background: {style['background']};\n            padding: 1.5rem;\n            border-radius: 15px;\n            color: white;\n            margin: 1rem 0;\n            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n        \">\n            <h3 style=\"margin: 0 0 1rem 0; color: {style['title_color']};\">\n                {style['icon']} {recommendation.get('title', 'Recommendation')}\n            </h3>\n            <p style=\"margin: 0; font-size: 1.1rem; line-height: 1.4;\">\n                {recommendation.get('description', 'No description available')}\n            </p>\n        </div>\n        \"\"\",\n        unsafe_allow_html=True\n    )\n\ndef create_time_series_chart(data: List[Dict], title: str = \"Traffic Over Time\") -> go.Figure:\n    \"\"\"\n    Create a time series chart for traffic data\n    \n    Args:\n        data: Time series data\n        title: Chart title\n        \n    Returns:\n        go.Figure: Plotly time series chart\n    \"\"\"\n    if not data:\n        return go.Figure()\n    \n    df = pd.DataFrame(data)\n    \n    fig = px.line(\n        df,\n        x='hour',\n        y='congestion_score',\n        title=title,\n        labels={'hour': 'Hour of Day', 'congestion_score': 'Congestion Level'}\n    )\n    \n    fig.update_traces(line=dict(width=3, color='#1f77b4'))\n    fig.update_layout(\n        height=400,\n        xaxis=dict(tickmode='linear', dtick=2),\n        yaxis=dict(range=[0, 1])\n    )\n    \n    return fig\n\ndef display_insight_panel(insights: List[str], panel_type: str = \"info\"):\n    \"\"\"\n    Display a panel with traffic insights\n    \n    Args:\n        insights: List of insight strings\n        panel_type: Type of panel (info, success, warning, error)\n    \"\"\"\n    panel_configs = {\n        \"info\": {\"color\": \"#17a2b8\", \"bg_color\": \"#d1ecf1\", \"icon\": \"üí°\"},\n        \"success\": {\"color\": \"#28a745\", \"bg_color\": \"#d4edda\", \"icon\": \"‚úÖ\"},\n        \"warning\": {\"color\": \"#ffc107\", \"bg_color\": \"#fff3cd\", \"icon\": \"‚ö†Ô∏è\"},\n        \"error\": {\"color\": \"#dc3545\", \"bg_color\": \"#f8d7da\", \"icon\": \"‚ùå\"}\n    }\n    \n    config = panel_configs.get(panel_type, panel_configs[\"info\"])\n    \n    insights_html = \"<br>\".join([f\"‚Ä¢ {insight}\" for insight in insights])\n    \n    st.markdown(\n        f\"\"\"\n        <div style=\"\n            background-color: {config['bg_color']};\n            border-left: 4px solid {config['color']};\n            padding: 1rem;\n            border-radius: 8px;\n            margin: 1rem 0;\n        \">\n            <h4 style=\"margin: 0 0 0.5rem 0; color: {config['color']};\">\n                {config['icon']} Traffic Insights\n            </h4>\n            <div style=\"color: #333; line-height: 1.5;\">\n                {insights_html}\n            </div>\n        </div>\n        \"\"\",\n        unsafe_allow_html=True\n    )\n\ndef create_efficiency_radar_chart(route_data: Dict) -> go.Figure:\n    \"\"\"\n    Create a radar chart showing route efficiency across multiple dimensions\n    \n    Args:\n        route_data: Route performance data\n        \n    Returns:\n        go.Figure: Plotly radar chart\n    \"\"\"\n    # Define categories and their values (0-100 scale)\n    categories = [\n        'Speed',\n        'Fuel Efficiency', \n        'Environmental Impact',\n        'Route Directness',\n        'Traffic Avoidance'\n    ]\n    \n    # Calculate scores based on route data (normalized to 0-100)\n    speed_score = min(100, (route_data.get('avg_speed_kmh', 30) / 60) * 100)\n    fuel_score = max(0, 100 - (route_data.get('fuel_consumption_l', 5) * 20))\n    env_score = max(0, 100 - (route_data.get('co2_emission_kg', 5) * 20))\n    directness_score = max(0, 100 - (route_data.get('route_factor', 1.0) - 1.0) * 100)\n    traffic_score = max(0, 100 - (route_data.get('congestion_score', 0.5) * 100))\n    \n    values = [speed_score, fuel_score, env_score, directness_score, traffic_score]\n    \n    fig = go.Figure()\n    \n    fig.add_trace(go.Scatterpolar(\n        r=values,\n        theta=categories,\n        fill='toself',\n        name='Route Performance',\n        line_color='rgb(0,100,200)',\n        fillcolor='rgba(0,100,200,0.25)'\n    ))\n    \n    fig.update_layout(\n        polar=dict(\n            radialaxis=dict(\n                visible=True,\n                range=[0, 100]\n            )\n        ),\n        title=\"üéØ Route Performance Radar\",\n        height=500\n    )\n    \n    return fig"